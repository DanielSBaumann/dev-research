<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragment :: head('Home')}"></head>

<body>

    <header th:replace="~{fragment :: header}"></header>

    <div id="chart-usuarios" style="width: 94%; height: 30vh;margin: 4vh auto;border: solid 1px #ccc;"></div>

    <div id="jr">
        <div id="q1-jr"></div>
    </div>

    <div class="container mt-5" style="font-size: .8em;">
        <p class="card-text">Devloped by <a href="https://github.com/DanielSBaumann">Daniel Baumann</a></p>
    </div>

    <!--JQUERY-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function () {
            $.ajax({
                url: '/contador',
                type: 'POST',
                success: function (responseText) {
                    $("#contador-pesquisas").val(responseText);
                },
                error: function () {
                    console.log('falha ao utilizar contador');
                }
            });
        });
    </script>
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
        crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

        let categoria;
        $.ajax({
            url: '/qtdporcategoria',
            type: 'POST',
            success: function (responseText) {
                categoria = JSON.parse(responseText)
            },
            error: function () {
            }
        });

        google
            .charts
            .load('current', { 'packages': ['corechart'] })
            .then(drawChartCategoria);

        //google.charts.setOnLoadCallback(drawChart);

        function drawChartCategoria() {
            const container = document.querySelector('#chart-usuarios')
            const data = new google.visualization.arrayToDataTable([
                ['Categoria', 'Quantidade'],
                [categoria[0].categoria, categoria[0].qtd],
                [categoria[1].categoria, categoria[1].qtd],
                [categoria[2].categoria, categoria[2].qtd]
            ])
            const options = {
                title: 'Categorias da pesquisa'
            }
            const chart = new google.visualization.PieChart(container)
            chart.draw(data, options)
            
        }

        function drawChartCategoria2() {
            /*const container = document.querySelector('#chart-usuarios')*/

            const data = new google.visualization.Query(categoria);
            data.send(processData);

            /*
            const data = new google.visualization.arrayToDataTable([
                ['Categoria', 'Quantidade'],
                [categoria[0].categoria, categoria[0].qtd],
                [categoria[1].categoria, categoria[1].qtd],
                [categoria[2].categoria, categoria[2].qtd]
            ])
            */

            function processData(dataChart) {

                const options = {
                    title: 'Categorias da pesquisa'
                }

                let table = dataChart.getDataTable();

                const container = document.querySelector('#chart-usuarios')

                const chart = new google.visualization.PieChart(container)
                chart.draw(table, options)

            }
            /*
            const options = {
                title: 'Categorias da pesquisa'
            }
            const chart = new google.visualization.PieChart(container)
            chart.draw(data, options)
            */
        }

        /**
         * const options = {
                title: 'Categorias da pesquisa',
                height: 400,
                width: 400
            }
         * 
         * para mais de um grafico
         * google.charts.setOnLoadCallback(drawChart1);
           google.charts.setOnLoadCallback(drawChart2);
        // OR
           google.charts.setOnLoadCallback(
               function() { // Anonymous function that calls drawChart1 and drawChart2
                   drawChart1();
                   drawChart2();
           });
         */

        $.ajax({
            url: '/chart',
            type: 'POST',
            success: function (responseText) {
                console.log('Teste Objeto para montagem dos charts')
                //console.log(responseText)
                console.log(JSON.parse(responseText))
            },
            error: function () {
                console.log('falha ao utilizar contador');
            }
        });

        /**
         *
         *
         * google
        .charts
        .load('current', {'packages':['bar']})
        .then(drawStuff);

      function drawStuff() {
        var data = new google.visualization.arrayToDataTable([
          ['Opening Move', 'Percentage'],
          ["King's pawn (e4)", 44],
          ["Queen's pawn (d4)", 31],
          ["Knight to King 3 (Nf3)", 12],
          ["Queen's bishop pawn (c4)", 10],
          ['Other', 3]
        ]);

        var options = {
          title: 'Chess opening moves',
          width: 360,
          legend: { position: 'none' },
          chart: { title: 'Chess opening moves',
                   subtitle: 'popularity by percentage' },
          bars: 'horizontal', // Required for Material Bar Charts.
          axes: {
            x: {
              0: { side: 'top', label: 'Percentage'} // Top x-axis.
            }
          },
          bar: { groupWidth: "90%" }
        };
        var chart = new google.charts.Bar(document.getElementById('top_x_div'));
        chart.draw(data, options);
      };
         */

    </script>

</body>

</html>